{% extends "base.html" %}
{% block title %}Add Card{% endblock %}

{% block content %}
  <h1 class="mb-4 text-center glow-title">âœ¨ Add New Card (All Forms)</h1>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="alert alert-success glass-card text-center">{{ messages[0] }}</div>
    {% endif %}
  {% endwith %}

  <!-- Quick edit by ID -->
  <div class="glass-card mb-4">
    <form class="row g-2 align-items-center" onsubmit="goEditById(event)">
      <div class="col-auto">
        <label for="editId" class="form-label">Quick edit by ID</label>
      </div>
      <div class="col-auto">
        <input type="number" min="1" class="form-control" id="editId" placeholder="Card ID">
      </div>
      <div class="col-auto">
        <button type="submit" class="btn btn-glow">Edit</button>
      </div>
      <div class="col-auto">
        <small class="text-muted">Find IDs on the History page.</small>
      </div>
    </form>
  </div>

  <div class="row">
    <!-- Form -->
    <div class="col-md-6">
      <div class="glass-card mb-4">
        <h4 class="mb-3">ğŸ“ Card Details</h4>
        <form method="POST" id="cardForm">
          <div class="mb-3">
            <label class="form-label">Base Name</label>
            <input type="text" class="form-control" name="base_name" id="base_name" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea class="form-control" name="description" id="description"></textarea>
          </div>
          <h5 class="mt-4 mb-2">Images by Form</h5>
          <div class="mb-3">
            <label class="form-label">ğŸŸ¦ Base Image URL</label>
            <input type="url" class="form-control" name="image_base" id="image_base" required>
          </div>
          <div class="mb-3">
            <label class="form-label">âœ¨ Awakened Image URL</label>
            <input type="url" class="form-control" name="image_awakened" id="image_awakened" required>
          </div>
          <div class="mb-3">
            <label class="form-label">ğŸ‰ Event Image URL</label>
            <input type="url" class="form-control" name="image_event" id="image_event" required>
          </div>
          <button type="submit" class="btn btn-glow w-100 mt-3">ğŸš€ Add All Forms</button>
        </form>
      </div>
    </div>

    <!-- Preview -->
    <div class="col-md-6">
      <div class="glass-card">
        <h4 class="mb-3">ğŸ‘ï¸ Live Preview</h4>
        <ul class="nav nav-tabs" id="previewTabs" role="tablist">
          <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#preview_base">Base</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#preview_awakened">Awakened</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#preview_event">Event</button></li>
        </ul>
        <div class="tab-content mt-3">
          <div class="tab-pane fade show active" id="preview_base">
            <div class="text-center">
              <h5 id="title_base">Card (Base) <span class="badge badge-form badge-base">ğŸŸ¦ Base</span></h5>
              <p id="desc_base">Description...</p>
              <img id="img_base" src="" class="img-fluid rounded shadow">
            </div>
          </div>
          <div class="tab-pane fade" id="preview_awakened">
            <div class="text-center">
              <h5 id="title_awakened">Card (Awakened) <span class="badge badge-form badge-awakened">âœ¨ Awakened</span></h5>
              <p id="desc_awakened">Description...</p>
              <img id="img_awakened" src="" class="img-fluid rounded shadow">
            </div>
          </div>
          <div class="tab-pane fade" id="preview_event">
            <div class="text-center">
              <h5 id="title_event">Card (Event) <span class="badge badge-form badge-event">ğŸ‰ Event</span></h5>
              <p id="desc_event">Description...</p>
              <img id="img_event" src="" class="img-fluid rounded shadow">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
  const baseName = document.getElementById("base_name");
  const desc = document.getElementById("description");
  const imgBase = document.getElementById("image_base");
  const imgAwakened = document.getElementById("image_awakened");
  const imgEvent = document.getElementById("image_event");

  function updatePreview() {
    const base = baseName.value || "Card";
    const description = desc.value || "Description...";

    document.getElementById("title_base").innerText = base + " (Base)";
    document.getElementById("desc_base").innerText = description;
    document.getElementById("img_base").src = imgBase.value;

    document.getElementById("title_awakened").innerText = base + " (Awakened)";
    document.getElementById("desc_awakened").innerText = description;
    document.getElementById("img_awakened").src = imgAwakened.value;

    document.getElementById("title_event").innerText = base + " (Event)";
    document.getElementById("desc_event").innerText = description;
    document.getElementById("img_event").src = imgEvent.value;
  }

  [baseName, desc, imgBase, imgAwakened, imgEvent].forEach(el => {
    el.addEventListener("input", updatePreview);
  });

  function goEditById(e) {
    e.preventDefault();
    const id = document.getElementById("editId").value;
    if (!id) return;
    window.location.href = `/edit/${id}`;
  }

  window.addEventListener("DOMContentLoaded", updatePreview);
</script>
{% endblock %}
