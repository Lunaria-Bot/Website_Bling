{% extends "base.html" %}
{% block title %}Add Card{% endblock %}

{% block content %}
  <h1 class="mb-4 page-title">Add Card (All Rarities)</h1>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="alert alert-success">{{ messages[0] }}</div>
    {% endif %}
  {% endwith %}

  <!-- Quick edit by ID -->
  <div class="card bg-dark text-white shadow-sm mb-4">
    <div class="card-body">
      <form class="row g-2 align-items-center" onsubmit="goEditById(event)">
        <div class="col-auto">
          <label for="editId" class="col-form-label">Quick edit by ID</label>
        </div>
        <div class="col-auto">
          <input type="number" min="1" class="form-control" id="editId" placeholder="Card ID">
        </div>
        <div class="col-auto">
          <button type="submit" class="btn btn-warning">Edit</button>
        </div>
        <div class="col-auto">
          <small class="text-muted">Tip: Find IDs on the History page.</small>
        </div>
      </form>
    </div>
  </div>

  <div class="row">
    <!-- Form -->
    <div class="col-md-6">
      <div class="card bg-dark text-white shadow-lg border-0 mb-4">
        <div class="card-body">
          <h4 class="card-title mb-3">üìù Card Details</h4>
          <form method="POST" id="cardForm">
            <div class="mb-3">
              <label class="form-label">Base Name</label>
              <input type="text" class="form-control" name="base_name" id="base_name" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" name="description" id="description"></textarea>
            </div>
            <h5 class="mt-4 mb-2">Images by Rarity</h5>
            <div class="mb-3">
              <label class="form-label">Common Image URL</label>
              <input type="url" class="form-control" name="image_common" id="image_common" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Rare Image URL</label>
              <input type="url" class="form-control" name="image_rare" id="image_rare" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Epic Image URL</label>
              <input type="url" class="form-control" name="image_epic" id="image_epic" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Legendary Image URL</label>
              <input type="url" class="form-control" name="image_legendary" id="image_legendary" required>
            </div>
            <button type="submit" class="btn btn-primary w-100 mt-3">‚ú® Add All</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Live Preview -->
    <div class="col-md-6">
      <div class="card bg-dark text-white shadow-lg border-0">
        <div class="card-body">
          <h4 class="card-title mb-3">üëÅÔ∏è Live Preview</h4>
          <div class="preview-card common mb-3">
            <h5 id="title_common">Card (Common) <span class="badge bg-light text-dark">Common</span></h5>
            <p id="desc_common">Description...</p>
            <img id="img_common" src="">
          </div>
          <div class="preview-card rare mb-3">
            <h5 id="title_rare">Card (Rare) <span class="badge bg-primary">Rare</span></h5>
            <p id="desc_rare">Description...</p>
            <img id="img_rare" src="">
          </div>
          <div class="preview-card epic mb-3">
            <h5 id="title_epic">Card (Epic) <span class="badge bg-purple">Epic</span></h5>
            <p id="desc_epic">Description...</p>
            <img id="img_epic" src="">
          </div>
          <div class="preview-card legendary">
            <h5 id="title_legendary">Card (Legendary) <span class="badge bg-warning text-dark">Legendary</span></h5>
            <p id="desc_legendary">Description...</p>
            <img id="img_legendary" src="">
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script>
    // Live preview wiring
    const baseName = document.getElementById("base_name");
    const desc = document.getElementById("description");
    const imgCommon = document.getElementById("image_common");
    const imgRare = document.getElementById("image_rare");
    const imgEpic = document.getElementById("image_epic");
    const imgLegendary = document.getElementById("image_legendary");

    function updatePreview() {
      const base = baseName.value || "Card";
      const description = desc.value || "Description...";

      document.getElementById("title_common").innerText = base + " (Common)";
      document.getElementById("desc_common").innerText = description;
      document.getElementById("img_common").src = imgCommon.value;

      document.getElementById("title_rare").innerText = base + " (Rare)";
      document.getElementById("desc_rare").innerText = description;
      document.getElementById("img_rare").src = imgRare.value;

      document.getElementById("title_epic").innerText = base + " (Epic)";
      document.getElementById("desc_epic").innerText = description;
      document.getElementById("img_epic").src = imgEpic.value;

      document.getElementById("title_legendary").innerText = base + " (Legendary)";
      document.getElementById("desc_legendary").innerText = description;
      document.getElementById("img_legendary").src = imgLegendary.value;
    }

    [baseName, desc, imgCommon, imgRare, imgEpic, imgLegendary].forEach(el => {
      el.addEventListener("input", updatePreview);
    });

    // Quick edit by ID
    function goEditById(e) {
      e.preventDefault();
      const id = document.getElementById("editId").value;
      if (!id) return;
      window.location.href = `/edit/${id}`;
    }
  </script>
{% endblock %}
