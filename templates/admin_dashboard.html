{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="row">
  <!-- Sidebar -->
  <div class="col-md-3" data-aos="fade-right">
    <div class="glass-card p-3">
      <h5 class="text-light mb-4">Navigation</h5>
      <ul class="nav flex-column">
        <li class="nav-item mb-2">
          <a class="nav-link text-light {% if request.endpoint == 'admin_dashboard' %}fw-bold text-primary{% endif %}" href="{{ url_for('admin_dashboard') }}">
            <i class="fas fa-chart-pie me-2"></i> Dashboard
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-light {% if request.endpoint == 'add_card' %}fw-bold text-primary{% endif %}" href="{{ url_for('add_card') }}">
            <i class="fas fa-plus me-2"></i> Add Card
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link text-light {% if request.endpoint == 'history' %}fw-bold text-primary{% endif %}" href="{{ url_for('history') }}">
            <i class="fas fa-clock me-2"></i> History
          </a>
        </li>
        <li class="nav-item">
          <span class="nav-link text-muted"><i class="fas fa-cogs me-2"></i> Manage (soon)</span>
        </li>
      </ul>
    </div>
  </div>

  <!-- Main Content -->
  <div class="col-md-9">
    <h1 class="page-title" data-aos="fade-down">Welcome to Warp Gate Bot</h1>

    <!-- Stat Cards -->
    <div class="row g-4 mb-5">
      <div class="col-md-4" data-aos="fade-up" data-aos-delay="100">
        <div class="glass-card text-center glow-hover">
          <i class="fas fa-layer-group fa-2x text-primary mb-2"></i>
          <h3>{{ stats.total }}</h3>
          <p class="text-muted">Total Cards</p>
        </div>
      </div>
      <div class="col-md-4" data-aos="fade-up" data-aos-delay="200">
        <div class="glass-card text-center glow-hover">
          <i class="fas fa-cube fa-2x text-info mb-2"></i>
          <h3>{{ stats.base }}</h3>
          <p class="text-muted">Base Forms</p>
        </div>
      </div>
      <div class="col-md-4" data-aos="fade-up" data-aos-delay="300">
        <div class="glass-card text-center glow-hover">
          <i class="fas fa-bolt fa-2x text-warning mb-2"></i>
          <h3>{{ stats.awakened }}</h3>
          <p class="text-muted">Awakened Forms</p>
        </div>
      </div>
    </div>

    <!-- Chart -->
    <div class="glass-card mb-5" data-aos="zoom-in">
      <canvas id="formChart"></canvas>
    </div>

    <!-- Recent Cards -->
    <h4 class="mb-3" data-aos="fade-right">Recently Added Cards</h4>
    {% for c in stats.recent %}
      <div class="glass-card mb-3 glow-hover" data-aos="fade-up" role="button" data-bs-toggle="modal" data-bs-target="#previewModal" data-id="{{ c.id }}" data-name="{{ c.character_name }}" data-form="{{ c.form }}" data-date="{{ c.created_at }}">
        <strong>#{{ c.id }}</strong> â€” {{ c.character_name }}
        <small class="text-muted">({{ c.form|capitalize }})</small><br>
        <small>Added: {{ c.created_at }}</small>
      </div>
    {% else %}
      <p class="text-muted">No recent cards found.</p>
    {% endfor %}
  </div>
</div>

<!-- Modal Preview -->
<div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-light">
      <div class="modal-header border-secondary">
        <h5 class="modal-title" id="previewModalLabel">Card Preview</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p><strong>ID:</strong> <span id="modalId"></span></p>
        <p><strong>Name:</strong> <span id="modalName"></span></p>
        <p><strong>Form:</strong> <span id="modalForm"></span></p>
        <p><strong>Created:</strong> <span id="modalDate"></span></p>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  const ctx = document.getElementById('formChart')?.getContext('2d');
  if (ctx) {
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Base', 'Awakened', 'Event'],
        datasets: [{
          data: [{{ stats.base }}, {{ stats.awakened }}, {{ stats.event }}],
          backgroundColor: ['#3498db', 'gold', '#e91e63']
        }]
      },
      options: {
        plugins: {
          legend: { labels: { color: '#fff' } }
        }
      }
    });
  }

  const previewModal = document.getElementById('previewModal');
  previewModal.addEventListener('show.bs.modal', event => {
    const trigger = event.relatedTarget;
    document.getElementById('modalId').textContent = trigger.dataset.id;
    document.getElementById('modalName').textContent = trigger.dataset.name;
    document.getElementById('modalForm').textContent = trigger.dataset.form;
    document.getElementById('modalDate').textContent = trigger.dataset.date;
  });
</script>
{% endblock %}
